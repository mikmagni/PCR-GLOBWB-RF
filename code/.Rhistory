combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
close(pb)
}
pb = txtProgressBar(min = 0, max = length(stationInfo), initial = 0)
#### a combined plot test ####
outputDir <- paste0('../RF/viz/', subsample, 'comboPlots/')
dir.create(outputDir, showWarnings = FALSE, recursive = TRUE)
for(i in (1:nrow(stationInfo))){
setTxtProgressBar(pb,i)
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i])) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
close(pb)
}
for(i in (1:nrow(stationInfo))){
setTxtProgressBar(pb,i)
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i])) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
}
KGE_table <- read.csv(paste0('../RF/validate/',subsample,'KGE_allpredictors.csv'))
View(KGE_table)
stationInfo <- read.csv(paste0('../RF/rf_input/',subsample,'test_stations.csv'))
View(resPlot)
View(stationInfo)
stationInfo_missin <- read.csv('../data/stationLatLon_missing')
stationInfo_missin <- read.csv('../data/stationLatLon_missing.csv')
KGE_table <- read.csv(paste0('../RF/validate/',subsample,'KGE_allpredictors.csv')) %>%
inner_join(.,read.csv('../data/stationLatLon_missing.csv'))
KGE_table <- read.csv(paste0('../RF/validate/',subsample,'KGE_allpredictors.csv')) %>%
inner_join(.,read.csv('../data/stationLatLon_missing.csv'), by='grdc_no')
View(KGE_table)
KGE_table <- read.csv(paste0('../RF/validate/',subsample,'KGE_allpredictors.csv')) %>%
inner_join(.,read.csv('../data/stationLatLon_missing.csv') %>% select(c('grdc_no','miss')), by='grdc_no')
View(stationInfo)
View(KGE_table)
View(KGE_table)
KGE_uncalib <- KGE_table$KGE[KGE_table$grdc_no==station_no]
KGE_uncalib <- KGE_table$KGE[KGE_table$grdc_no==station_no]
KGE_corrected <- KGE_table$KGE_corrected[KGE_table$grdc_no==station_no]
miss_data <- KGE_table$miss[KGE_table$grdc_no==station_no]
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE:', KGE_uncalib, '(uncalibrated), ', KGE_corrected, '(RF-corrected)')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
KGE_corrected <- round(KGE_table$KGE_corrected[KGE_table$grdc_no==station_no],2)
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE:', KGE_uncalib, '(uncalibrated), ', KGE_corrected, '(RF-corrected)')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE:', KGE_uncalib, '(uncalibrated), ', KGE_corrected, '(RF-corrected)\n',
'Missing data (1979-2019):', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(text = element_text('mono'))
combined
?replace_with_na
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
mutate(.,replace=list(pcr[is.na(obs)])) %>%
mutate(.,replace=list(pcr_corrected[is.na(obs)]))
View(all_q)
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
replace=list(pcr[is.na(obs)]) %>%
replace=list(pcr_corrected[is.na(obs)])
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
mutate(pcr=na_if(is.na(obs))) #%>%
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
mutate(.,pcr=na_if(is.na(obs))) #%>%
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
mutate(.,pcr=na_if(obs, NA))) #%>%
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
mutate(.,pcr=na_if(obs, NA)) #%>%
View(all_q)
## plot observed, uncalibrated, corrected hydrograph
subsample <- 'subsample 1/' # choose subsample number here
dir <- paste0('../RF/validate/', subsample, 'tables_allpredictors/')
stationInfo <- read.csv(paste0('../RF/rf_input/',subsample,'test_stations.csv'))
KGE_table <- read.csv(paste0('../RF/validate/',subsample,'KGE_allpredictors.csv')) %>%
inner_join(.,read.csv('../data/stationLatLon_missing.csv') %>% select(c('grdc_no','miss')), by='grdc_no')
#### a combined plot test ####
outputDir <- paste0('../RF/viz/', subsample, 'comboPlots/')
dir.create(outputDir, showWarnings = FALSE, recursive = TRUE)
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
KGE_corrected <- round(KGE_table$KGE_corrected[KGE_table$grdc_no==station_no],2)
miss_data <- KGE_table$miss[KGE_table$grdc_no==station_no]
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(text = element_text('mono'))
combined
####-------------------------------####
source('fun_3_hydrograph_fdc_residuals.R')
hg <- plot_hydrograph()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(text = element_text('mono'))
combined
View(all_q)
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) #%>%
View(all_q)
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
replace_with_na(replace = list(pcr[is.na(obs)]))
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
replace_with_na(.,replace = list(pcr[is.na(obs)]))
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected) %>%
replace_with_na(replace = list(pcr = 1))
which[all_q$obs==NA]
class(all_q$obs)
is.na(all_q$obs)
all_q$obs[is.na(all_q$obs)]
all_q <- read.csv(paste0(dir, 'rf_result_', station_no,'.csv'), header = T) %>%
mutate(datetime=as.Date(datetime)) %>% select(., datetime:res_corrected)
all_q$pcr[is.na[all_q$obs]] <- NA
all_q$pcr[is.na(all_q$obs)] <- NA
all_q$pcr_corrected[is.na(all_q$obs)] <- NA
####-------------------------------####
source('fun_3_hydrograph_fdc_residuals.R')
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
'\nKGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%') &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i],
'\nKGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(plot.caption.position = 'top')
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(plot.caption.position = 'top') &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(plot.caption.position = 'panel') &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 10)) &
theme(plot.caption.position = 'plot') &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(hjust = 10,size = 10)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(hjust = 1,size = 10)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(vjust = 1,size = 10)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(vjust = -1,size = 10)) &
theme(text = element_text('mono'))
combined
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 12)) &
theme(text = element_text('mono'))
combined
pcmclapply(1:nrow(stationInfo), plot_all, mc.cores=1)
pbmclapply(1:nrow(stationInfo), plot_all, mc.cores=1)
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
plot_all <- function(i){
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
KGE_corrected <- round(KGE_table$KGE_corrected[KGE_table$grdc_no==station_no],2)
miss_data <- KGE_table$miss[KGE_table$grdc_no==station_no]
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 12)) &
theme(text = element_text('mono'))
combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
}
pbmclapply(1:nrow(stationInfo), plot_all, mc.cores=1)
#### a combined plot test ####
outputDir <- paste0('../RF/viz/', subsample, 'comboPlots/')
dir.create(outputDir, showWarnings = FALSE, recursive = TRUE)
pbmclapply(1:nrow(stationInfo), plot_all, mc.cores=1)
####-------------------------------####
source('fun_0_loadLibrary.R')
####-------------------------------####
source('fun_3_hydrograph_fdc_residuals.R')
## plot observed, uncalibrated, corrected hydrograph
subsample <- 'subsample 1/' # choose subsample number here
dir <- paste0('../RF/validate/', subsample, 'tables_allpredictors/')
stationInfo <- read.csv(paste0('../RF/rf_input/',subsample,'test_stations.csv'))
KGE_table <- read.csv(paste0('../RF/validate/',subsample,'KGE_allpredictors.csv')) %>%
inner_join(.,read.csv('../data/stationLatLon_missing.csv') %>% select(c('grdc_no','miss')), by='grdc_no')
#### a combined plot test ####
outputDir <- paste0('../RF/viz/', subsample, 'comboPlots/')
dir.create(outputDir, showWarnings = FALSE, recursive = TRUE)
print('plotting...')
plot_all <- function(i){
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
KGE_corrected <- round(KGE_table$KGE_corrected[KGE_table$grdc_no==station_no],2)
miss_data <- KGE_table$miss[KGE_table$grdc_no==station_no]
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 12)) &
theme(text = element_text('mono'))
combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
}
pbmclapply(1:nrow(stationInfo), plot_all, mc.cores=48)
station_no <- stationInfo$grdc_no[i]
pbmclapply(i=1:nrow(stationInfo), plot_all, mc.cores=1)
pbmclapply(i=1:nrow(stationInfo), FUN=plot_all, mc.cores=1)
pbmclapply(x=1:nrow(stationInfo), plot_all, mc.cores=1)
pbmclapply(x=1:nrow(stationInfo), FUN=plot_all, mc.cores=1)
pbmclapply(1:nrow(stationInfo), plot_all, mc.cores=1)
i=1
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
remove(i)
lapply
lapply(1:nrow(stationInfo), plot_all, mc.cores=1)
lapply(1:nrow(stationInfo), plot_all)
mclapply(1:nrow(stationInfo), plot_all)
mclapply(1:nrow(stationInfo), plot_all, mc.cores=48)
plot_all <- function(i){
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
KGE_corrected <- round(KGE_table$KGE_corrected[KGE_table$grdc_no==station_no],2)
miss_data <- KGE_table$miss[KGE_table$grdc_no==station_no]
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 12)) &
theme(text = element_text('mono'))
combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
}
lapply(1:nrow(stationInfo), plot_all)
lapply(1, plot_all)
pblapply(1:nrow(stationInfo), plot_all)
pbapply(1:nrow(stationInfo), plot_all)
####-------------------------------####
source('fun_0_loadLibrary.R')
pbapply(1:nrow(stationInfo), plot_all)
plot_all <- function(i){
station_no <- stationInfo$grdc_no[i]
upstreamArea <- stationInfo$area[i]
convRatio <- upstreamArea/0.0864
KGE_uncalib <- round(KGE_table$KGE[KGE_table$grdc_no==station_no],2)
KGE_corrected <- round(KGE_table$KGE_corrected[KGE_table$grdc_no==station_no],2)
miss_data <- KGE_table$miss[KGE_table$grdc_no==station_no]
hg <- plot_hydrograph()
fdc <- plot_ecdf()
resPlot <- plot_residuals()
combined <- hg / fdc  / resPlot
combined <- combined +
plot_annotation(
title = (paste0(station_no,' : ', str_to_title(stationInfo$station[i]), ' (',
str_to_title(stationInfo$river[i]), ', ', stationInfo$country[i], ')')),
subtitle = paste0('lat: ', stationInfo$lat[i], ', lon: ', stationInfo$lon[i]),
caption = paste0('KGE: ', KGE_uncalib, ' (uncalibrated), ', KGE_corrected, ' (RF-corrected)\n',
'Missing data (1979-2019): ', miss_data, '%')) &
theme(plot.title = element_text(hjust= 0.5, size = 18, face='bold')) &
theme(plot.subtitle = element_text(hjust= 0.5, size = 14)) &
theme(plot.caption = element_text(size = 12)) &
theme(text = element_text('mono'))
combined
ggsave(paste0(outputDir,'comboPlot_',station_no,'.png'), combined, height=10, width=20, units='in', dpi=300)
}
pbapply(1:nrow(stationInfo), plot_all)
pblapply(1:nrow(stationInfo), plot_all)
foreach(1:nrow(stationInfo)) %dopar% {plot_all}
####-------------------------------####
source('fun_0_loadLibrary.R')
